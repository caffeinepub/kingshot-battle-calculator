{
  "kind": "build_request",
  "title": "Activate OCR image upload functionality",
  "projectName": "Kingshot Battle Calculator",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-33",
      "text": "Remove all 'coming soon' placeholder text from both My Troops and Enemy Troops image upload buttons in BattleCalculatorForm",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-build"
        ],
        "quotes": [
          "it says that the OCR system is coming soon and to upload data manually",
          "the upload button says the feature is coming soon"
        ]
      },
      "acceptanceCriteria": [
        "Upload buttons display actionable text like 'Upload scout image' instead of 'Or upload your scout image (coming soon)'",
        "No placeholder text suggests the feature is unavailable"
      ]
    },
    {
      "id": "REQ-34",
      "text": "Remove the error alert message 'Image OCR feature is not yet available. Please paste scout data manually or contact support to enable this feature.' that appears when users click the upload buttons",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-build"
        ],
        "quotes": [
          "you can also see in the bottom right the error message",
          "Image OCR feature is not yet available. Please paste scout data manually or contact support to enable this feature."
        ]
      },
      "acceptanceCriteria": [
        "No error alert appears when upload buttons are clicked",
        "Upload buttons trigger file picker instead of showing error messages"
      ]
    },
    {
      "id": "REQ-35",
      "text": "Connect both My Troops and Enemy Troops upload buttons to the existing extractScoutFromImage function in ocrExtraction.ts to process uploaded images immediately",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-build"
        ],
        "quotes": [
          "the OCR feature was deployed but the upload buttons are still showing placeholder messages instead of actually triggering the extraction"
        ]
      },
      "acceptanceCriteria": [
        "Clicking My Troops upload button opens file picker and processes selected image through extractScoutFromImage",
        "Clicking Enemy Troops upload button opens file picker and processes selected image through extractScoutFromImage",
        "Each upload routes extraction results to correct state (myTroops vs enemyTroops) without cross-contamination"
      ]
    },
    {
      "id": "REQ-36",
      "text": "Verify the OCR extraction workflow correctly identifies tier (Roman numerals I-XI at bottom of troop icons) and TG level (digit 1-5 at top-right corner of troop icons) from the uploaded scout report images, as shown in the user's circled examples where 'X' represents Tier 10 and '3' represents TG Level 3",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-build"
        ],
        "quotes": [
          "You can also see where I have circled in red where the TG level is as well as the Roman numeral indicating the troop tier (in the example it says \"X\" for tier 10 troops and 3 for TG3 troops)"
        ]
      },
      "acceptanceCriteria": [
        "OCR correctly extracts Roman numeral 'X' from bottom of troop icons and converts to Tier 10",
        "OCR correctly extracts digit '3' from top-right corner of troop icons and identifies as TG Level 3",
        "Tier and TG dropdowns auto-populate with extracted values after image processing",
        "Extraction works for all tier values (I-XI) and TG levels (1-5)"
      ]
    },
    {
      "id": "REQ-37",
      "text": "Ensure the complete OCR workflow auto-populates all form fields after successful image extraction: scout paste textarea with full extracted text, march size field, tier and TG dropdowns, and troop counts (infantry/cavalry/archer), while keeping all fields editable for manual corrections",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-build"
        ],
        "quotes": [
          "the OCR workflow properly processes images and populates the form fields"
        ]
      },
      "acceptanceCriteria": [
        "Scout paste textarea displays OCR extracted text after image upload",
        "March size field auto-fills from extracted value or troop total sum",
        "Tier and TG dropdowns auto-select based on extracted Roman numerals and digits",
        "Troop count fields (infantry/cavalry/archer) populate with extracted values",
        "All auto-filled fields remain editable for user corrections",
        "Loading state displays during OCR processing"
      ]
    },
    {
      "id": "REQ-38",
      "text": "Display clear, actionable error messages when OCR extraction fails, guiding users to ensure their screenshot shows a clear Kingshot scout report with visible troop icons and stat bonuses",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-user-build"
        ],
        "quotes": [
          "Update error handling for image upload to catch OCR failures, display user-friendly error messages when extraction fails"
        ]
      },
      "acceptanceCriteria": [
        "Failed extractions show specific error messages like 'Could not extract scout data. Please ensure the image shows a clear Kingshot scout report with visible troop icons.'",
        "Error messages provide guidance on image quality requirements",
        "Extraction failures do not crash the application or leave UI in broken state"
      ]
    }
  ],
  "constraints": [
    "Do not modify the existing extractScoutFromImage, canvasUtils, or textParsing utility implementations",
    "Preserve all OCR extraction logic including tier Roman numeral detection (I-XI) and TG digit extraction (1-5)",
    "Keep scout paste textareas, march size field, and all dropdowns editable after auto-fill",
    "Maintain separate state handling for My Troops vs Enemy Troops image uploads"
  ],
  "nonGoals": [
    "Changing the OCR extraction algorithm or canvas preprocessing logic",
    "Adding new form fields or validation rules",
    "Modifying the battle calculation engine or result display",
    "Implementing backend image processing"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}